<div class="orders-page">
  <h1>Orders</h1>

  <!-- Filters -->
  <div class="filters">
    <input
      type="text"
      placeholder="Search by customer..."
      [value]="searchFilter()"
      (input)="onSearchChange($event)"
    />
    <label>
      From:
      <input type="date" [(ngModel)]="fromDate" (change)="onDateRangeChange({from: fromDate!, to: toDate!})"/>
    </label>
    <label>
      To:
      <input type="date" [(ngModel)]="toDate" (change)="onDateRangeChange({from: fromDate!, to: toDate!})"/>
    </label>
    <select [value]="statusFilter()" (change)="onStatusChange($event)">
      <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
    </select>
    <button class="btn-reset" (click)="resetFilters()">Reset</button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()">Loading orders...</div>

  <!-- Error -->
  <div *ngIf="error()" class="error">{{ error() }}</div>

  <!-- Orders table -->
  <table *ngIf="!loading() && !error()">
    <thead>
    <tr>
      <th>ID</th>
      <th>Customer</th>
      <th>Status</th>
      <th>Total</th>
      <th (click)="toggleDateSort()" class="cursor-pointer">
        Created At
        <span *ngIf="sortField() === 'createdAt'">
          {{ sortDir() === 'asc' ? '⬆' : '⬇' }}
        </span>
      </th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let order of filteredOrders()" [routerLink]="['/orders', order.id]">
      <td>{{ order.id }}</td>
      <td>{{ order.customer.name }}</td>
      <td>{{ order.status }}</td>
      <td>{{ order.total | currency }}</td>
      <td>{{ order.createdAt | date }}</td>
      <td>
        <button (click)="markAsProcessing(order.id)" [disabled]="order.status !== 'pending'">Processing</button>
        <button (click)="shipOrder(order.id)" [disabled]="order.status !== 'processing'">Ship</button>
        <button (click)="cancelOrder(order.id)" [disabled]="order.status === 'shipped' || order.status === 'cancelled'">
          Cancel
        </button>
      </td>
    </tr>
    </tbody>
  </table>

  <app-pagination
    [currentPage]="page"
    [totalPages]="totalPages()"
    [totalOrders]="totalOrders()"
    (pageChange)="onPageChange($event)">
  </app-pagination>
</div>
